#!/usr/bin/octave -q

# Set path
addpath('./suites');

testcases = ACID(0);

# Command line arguments can be used to generate only a subset of tests.
argList = argv();
if length(argList) > 0
    # convert command line arguments into list
    testlist = [];
    for arg = argList(:)'
       k = str2num(arg{1,1});
       if (k < 1 || k > length(testcases))
           error('Illegal test number %d. (Choose numbers between 1 and %d.)', k, length(testcases));
       end
       testlist = [testlist, k];
    end
else
    testlist = [1:length(testcases)];
endif

# Create 
#
template = [ ...
 '%%!test\n', ...
 '%%! display(''Test %d...'');\n', ...
 '%%! graphics_toolkit gnuplot\n', ...
 '%%! try\n', ...
 '%%!   out = ACID(%d);\n', ...
 '%%! catch e\n', ...
 '%%!   error(''Exception in ACID:\\n%%s'', e.message);\n', ...
 '%%! end\n', ...
 '%%! display(out.description);\n', ...
 '%%! if ~(isfield(out, ''skip'') && out.skip)\n', ...
 '%%!   outputFile = ''data/converted/test%d-converted.tex'';\n', ...
 '%%!   display(sprintf(''output file %%s'', outputFile));\n', ...
 '%%!   try\n', ...
 '%%!     matlab2tikz( ...\n', ...
 '%%!       ''filename'', outputFile, ...\n', ...
 '%%!       ''width'', ''5cm'', ...\n', ...
 '%%!       ''showInfo'', false, ...\n', ...
 '%%!       ''checkForUpdates'', false, ...\n', ...
 '%%!       ''dataPath'', ''data/converted/'', ...\n', ...
 '%%!       ''standalone'', true ...\n', ...
 '%%!       );\n', ...
 '%%!   catch e\n', ...
 '%%!     error(''Exception in matlab2tikz:\\n%%s'', e.message);\n', ...
 '%%!   end\n', ...
 '%%!   %%type(outputFile);\n', ...
 '%%!   assert(md5sum(outputFile), out.md5);\n', ...
 '%%! end\n', ...
 '%%! close all;\n', ...
 '%%!\n' ...
 ];

# Create test entries for all tests
testfile = 'testlist.m';
fh = fopen(testfile, 'w');
for k = testlist
  fprintf(fh, template, k, k, k);
end
fclose(fh);
